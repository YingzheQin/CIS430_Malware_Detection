import pandas as pd
import numpy as np
from PIL import Image
from pathlib import Path

# 1. Load data
df = pd.read_csv('beneware/extracted_data.csv')

# Check if there is a 'hash' column, we can use it for naming the images, otherwise use the index
has_hash_column = 'hash' in df.columns

# 2. Extract features and convert to 32x32 grayscale images
if has_hash_column:
    features = df.drop(columns=['hash'])
else:
    features = df

images = features.values.reshape(-1, 32, 32)

# 3. Save images
save_path = Path("beneware/image_of_exe")

for idx, image_array in enumerate(images):
    if not save_path.exists():
        save_path.mkdir(parents=True)
    image = Image.fromarray((image_array * 255).astype(np.uint8))
    if has_hash_column:
        image_name = df.iloc[idx]['hash'] + ".jpg"
    else:
        image_name = f"image_{idx}.jpg"
    image_path = save_path / image_name
    image.save(image_path)
